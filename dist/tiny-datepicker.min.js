!function(t){var e="object"==typeof window&&window||"object"==typeof self&&self;"undefined"==typeof module||"undefined"==typeof exports||exports.nodeType?e&&(e.tinyDatePicker=t(),"function"==typeof define&&define.amd&&define([],function(){return e.tinyDatePicker})):module.exports=t()}(function(){function l(t){for(var e=""+t,a=e.length;a++<2;)e="0"+e;return e}function w(t,e){return new Date(t,e-1,1)}function k(t,e){return new Date(t,e-1,0)}function _(t,e){return new Date(t,e,0).getDate()}function u(t){var e="scroll"+t[0].toUpperCase()+t.slice(1);return document.documentElement&&document.documentElement[e]?document.documentElement[e]:document.body[e]}var t={clearable:!1,daysOfWeekDisabled:[],format:"yyyy-mm-dd",lang:"zh-CN",showWeekDays:!0,templates:null,weekStart:0,zIndex:2019,disabledDate:null},i=/dd?|DD?|mm?|MM?|yy(?:yy)?/g;function s(t,e){this.$el=t,this.$input="input"===t.tagName.toLowerCase()?t:t.querySelector("input"),this.options=e||{},this.$datePicker=null,this.value=null,this.state={isVisible:!1,isMounted:!1,showStatus:0,weekData:[],dateData:[],monthData:[],yearData:[],date:null,month:null,year:null},this.register()}s.prototype.register=function(){this.$input.addEventListener("focus",this.onShow.bind(this)),this.$input.addEventListener("click",this.onShow.bind(this)),this.$input.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("click",this.onHide.bind(this))},s.prototype.init=function(){this.initOptions(),this.initData(),this.initDom(),this.render(),this.initEvent()},s.prototype.initOptions=function(){this.settings=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),a=1;a<arguments.length;a++){var i=arguments[a];if(null!=i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}({},t,this.options)},s.prototype.initData=function(){this.initWeekData(),this.initDateData(),this.initMonthData(),this.initYearData()},s.prototype.initWeekData=function(){for(var t=this.getI18n().daysMin,e=this.getWeekStart(),a=0;a<e;a++)t.push(t.shift());this.state.weekData=t},s.prototype.initDateData=function(){var t=this.state.year,e=this.state.month;if(!t||!e){var a=new Date;t=a.getFullYear(),e=a.getMonth()+1}var i=w(t,e),n=w(t,e).getDay();e=i.getMonth()+1;var s=k(t=i.getFullYear(),e),r=k(t,e).getDate(),o=s.getMonth()+1,h=s.getFullYear(),l=_(t,e),d=new Date(t,e,1),c=d.getMonth()+1,p=d.getFullYear(),u=6,y=this.getWeekStart();if(this.state.dateData=[],n===y){for(var f=6;0<=f;f--)this.state.dateData.unshift({day:(f+y)%7,date:r+f-7+1,month:o,year:h});u--}for(var g=(7-Math.abs(y-n))%7,b=0;b<7*u;b++){var D,v,m;m=b<g?(D=r-g+b+1,v=o,h):l+g-1<b?(D=b-l-g+1,v=c,p):(D=b-g+1,v=e,t),this.state.dateData.push({day:(b+y)%7,date:D,month:v,year:m})}this.state.month=e,this.state.year=t},s.prototype.initMonthData=function(){var t=this.getI18n().monthsShort;this.state.monthData=t.map(function(t,e){return{label:t,value:e+1}})},s.prototype.initYearData=function(){var t=this.state.year,e=t-t%10;this.state.yearData=[];for(var a=0;a<10;a++)this.state.yearData.push(e+a)},s.prototype.initDom=function(){var t=this.getI18n(),e=t.today,a=t.clear,i=t.titleExchange,n=this.settings,s=n.clearable,r=n.templates,o="&lt;&lt;",h="&lt;",l="&gt;&gt;",d="&gt;";r&&(o=r.prevYearArrow||o,h=r.prevMonthArrow||h,l=r.nextYearArrow||l,d=r.nextMonthArrow||d);var c=['<div class="tiny-datepicker__header">','<button class="tiny-datepicker__btn tiny-datepicker__prev-btn tiny-datepicker__prev-year">'+o+"</button>",'<button class="tiny-datepicker__btn tiny-datepicker__prev-btn tiny-datepicker__prev-month">'+h+"</button>",'<span class="tiny-datepicker__header-label tiny-datepicker__show-year"></span>','<span class="tiny-datepicker__header-label tiny-datepicker__show-month"></span>','<button class="tiny-datepicker__btn tiny-datepicker__next-btn tiny-datepicker__next-year">'+l+"</button>",'<button class="tiny-datepicker__btn tiny-datepicker__next-btn tiny-datepicker__next-month">'+d+"</button>","</div>",'<div class="tiny-datepicker__body">','<table class="tiny-datepicker__table tiny-datepicker__date-table">',"<thead></thead>","<tbody></tbody>","</table>",'<table class="tiny-datepicker__table tiny-datepicker__month-table">',"<tbody></tbody>","</table>",'<table class="tiny-datepicker__table tiny-datepicker__year-table">',"<tbody></tbody>","</table>","</div>",'<div class="tiny-datepicker__footer" style="display: '+(s?"block":"none")+'">','<button class="tiny-datepicker__footer-btn tiny-datepicker__now-btn"><span>'+e+"</span></button>",'<button class="tiny-datepicker__footer-btn tiny-datepicker__clear-btn"><span>'+a+"</span></button>","</div>"];if(i){var p=c[3];c[3]=c[4],c[4]=p}var u=document.createElement("div");u.className="tiny-datepicker__wrapper",u.innerHTML=c.join(""),this.$datePicker=u,this.$showYear=this.getDom(".tiny-datepicker__show-year"),this.$showMonth=this.getDom(".tiny-datepicker__show-month"),this.$dateTable=this.getDom(".tiny-datepicker__date-table"),this.$monthTable=this.getDom(".tiny-datepicker__month-table"),this.$yearTable=this.getDom(".tiny-datepicker__year-table"),this.$prevYear=this.getDom(".tiny-datepicker__prev-year"),this.$prevMonth=this.getDom(".tiny-datepicker__prev-month"),this.$nextMonth=this.getDom(".tiny-datepicker__next-month"),this.$nextYear=this.getDom(".tiny-datepicker__next-year"),this.$datePickerFooter=this.getDom(".tiny-datepicker__footer"),this.$nowBtn=this.getDom(".tiny-datepicker__now-btn"),this.$clearBtn=this.getDom(".tiny-datepicker__clear-btn")},s.prototype.onShow=function(){this.state.isVisible||(this.state.isMounted?(this.changeView(0),this.renderForShowStatus(),this.show()):this.init(),this.adjustPosition())},s.prototype.onHide=function(t){var e=t.target;this.state.isVisible&&this.isValidClick(e)&&this.hide()},s.prototype.show=function(){this.$datePicker&&(this.$datePicker.style.display="block",this.state.isVisible=!0)},s.prototype.hide=function(){this.$datePicker&&(this.$datePicker.style.display="none",this.state.isVisible=!1)},s.prototype.handleKeyDown=function(t){var e=t.keyCode,a=this;27===e&&a.hide(),9===e&&setTimeout(function(){this.$input!==document.activeElement&&a.hide()},0)},s.prototype.adjustPosition=function(){var t=this.$el.getBoundingClientRect(),e=this.$datePicker.getBoundingClientRect(),a=t.top,i=t.left,n=t.bottom,s=t.right-i,r=n-a,o=e.right-e.left,h=e.bottom-e.top,l=u("top"),d=u("left"),c=window.innerWidth,p="tiny-datepicker__wrapper tiny-datepicker__";window.innerHeight<a+h+8?(this.$datePicker.style.top=a-h+l-8+"px",p+="top"):(this.$datePicker.style.top=a+r+l+8+"px",p+="bottom"),c<i+o?(this.$datePicker.style.left=i-o+s+d+"px",p+="-right"):(this.$datePicker.style.left=i+d+"px",p+="-left"),this.settings.clearable&&(p+=" tiny-datepicker__clearable"),this.$datePicker.className=p,this.$datePicker.style.zIndex=this.settings.zIndex},s.prototype.render=function(){this.renderWeekData(),this.renderDateData(),this.renderMonthData(),this.renderYearData(),this.changeView(this.state.showStatus),this.mount()},s.prototype.mount=function(){this.state.isVisible=!0,this.state.isMounted=!0,document.body.appendChild(this.$datePicker)},s.prototype.renderWeekData=function(){if(this.settings.showWeekDays){var t=[],e=this.state.weekData;t.push("<tr>");for(var a=0,i=e.length;a<i;a++)t.push("<th>"+e[a]+"</th>");t.push("</tr>"),this.$dateTable.querySelector("thead").innerHTML=t.join("")}},s.prototype.renderDateData=function(){for(var t=[],e=this.state.dateData,a=0,i=e.length;a<i;a++){var n=e[a],s=this.getDateTdClass(n);a%7==0&&t.push("<tr>"),t.push('<td class="'+s+'"><span>'+n.date+"</span></td>"),a%7==6&&t.push("</tr>")}this.$dateTable.querySelector("tbody").innerHTML=t.join("")},s.prototype.reRenderDateData=function(){for(var t=this.state.dateData,e=this.$dateTable.querySelectorAll("tbody tr td"),a=0,i=t.length;a<i;a++){var n=t[a],s=e[a];s.className=this.getDateTdClass(n),s.innerHTML="<span>"+n.date+"</span>"}this.changeDateTableHeaderView()},s.prototype.getDateTdClass=function(t){var e=this.state.year,a=this.state.month,i="";if(t.month<a&&t.year<=e)i="prev-month";else if(t.month===a&&t.year===e){i="available";var n=new Date;n.getFullYear()===e&&n.getMonth()+1===a&&n.getDate()===t.date&&(i+=" today"),this.value&&this.value.getFullYear()===e&&this.value.getMonth()+1===a&&this.value.getDate()===t.date&&(i+=" selected")}else i="next-month";var s=this.settings,r=s.daysOfWeekDisabled||[],o=s.disabledDate;return-1<r.indexOf(t.day)?i+=" disabled":o&&"function"==typeof o&&o(new Date(t.year+"-"+l(t.month)+"-"+l(t.date)+" 00:00:00"))&&(i+=" disabled"),i},s.prototype.renderMonthData=function(){for(var t=[],e=this.state.monthData,a=0,i=e.length;a<i;a++){var n=this.getMonthTdClass(e[a]);a%4==0&&t.push("<tr>"),t.push('<td class="'+n+'"><span>'+e[a].label+"</span></td>"),a%4==3&&t.push("</tr>")}this.$monthTable.querySelector("tbody").innerHTML=t.join("")},s.prototype.reRenderMonthData=function(){for(var t=this.state.monthData,e=this.$monthTable.querySelectorAll("tbody tr td"),a=0,i=t.length;a<i;a++){e[a].className=this.getMonthTdClass(t[a])}this.changeMonthTableHeaderView()},s.prototype.getMonthTdClass=function(t){var e=this.state.year,a="available",i=new Date;return i.getFullYear()===e&&i.getMonth()+1===t.value&&(a+=" today"),this.value&&this.value.getFullYear()===e&&this.value.getMonth()+1===t.value&&(a+=" selected"),a},s.prototype.renderYearData=function(){for(var t=[],e=this.state.yearData,a=0;a<12;a++){var i=this.getYearTdClass(e[a]);a%4==0&&t.push("<tr>"),t.push('<td><span class="'+i+'">'+(e[a]||"")+"</span></td>"),a%4==3&&t.push("</tr>")}this.$yearTable.querySelector("tbody").innerHTML=t.join("")},s.prototype.reRenderYearData=function(){for(var t=this.state.yearData,e=this.$yearTable.querySelectorAll("tbody tr td"),a=0,i=t.length;a<i;a++){var n=t[a],s=e[a];s.className=this.getYearTdClass(n),s.innerHTML="<span>"+n+"</span>"}this.changeYearTableHeaderView()},s.prototype.getYearTdClass=function(t){var e="available";return(new Date).getFullYear()===t&&(e+=" today"),this.value&&this.value.getFullYear()===t&&(e+=" selected"),e},s.prototype.initEvent=function(){this.$showMonth.addEventListener("click",this.changeMonthView.bind(this)),this.$showYear.addEventListener("click",this.changeYearView.bind(this)),this.$prevYear.addEventListener("click",this.doPrevYear.bind(this)),this.$prevMonth.addEventListener("click",this.doPrevMonth.bind(this)),this.$nextMonth.addEventListener("click",this.doNextMonth.bind(this)),this.$nextYear.addEventListener("click",this.doNextYear.bind(this)),this.$nowBtn.addEventListener("click",this.setTodayValue.bind(this)),this.$clearBtn.addEventListener("click",this.clearValue.bind(this)),this.initChooseEvent()},s.prototype.initChooseEvent=function(){for(var t=[this.$dateTable,this.$monthTable,this.$yearTable],e=["onChooseDate","onChooseMonth","onChooseYear"],a=0,i=t.length;a<i;a++)for(var n=t[a].querySelectorAll("tbody tr td"),s=0,r=n.length;s<r;s++)n[s].addEventListener("click",this[e[a]].bind(this,s,n[s]))},s.prototype.onChooseDate=function(t,e){if(!(-1<e.className.search(/\bdisabled\b/))){var a=this.state.dateData[t],i=a.date,n=a.month,s=a.year;this.setValue(s,n,i)}},s.prototype.onChooseMonth=function(t){var e=this.state.monthData[t].value;this.state.month=e,this.changeDateView()},s.prototype.onChooseYear=function(t){var e=this.state.yearData[t];this.state.year=e,this.changeMonthView()},s.prototype.toggleMonthBtnView=function(e){[this.$showMonth,this.$prevMonth,this.$nextMonth].forEach(function(t){t.style.display=e?"":"none"})},s.prototype.changeDateView=function(){this.changeView(0),this.renderForShowStatus()},s.prototype.changeDateTableHeaderView=function(){this.isDateView()&&(this.$showYear.innerHTML=this.formatYear(this.state.year),this.$showMonth.innerHTML=this.formatMonth(this.state.year,this.state.month))},s.prototype.changeMonthView=function(){this.changeView(1),this.renderForShowStatus()},s.prototype.changeMonthTableHeaderView=function(){this.isMonthView()&&(this.$showYear.innerHTML=this.formatYear(this.state.year))},s.prototype.changeYearView=function(){this.changeView(2),this.renderForShowStatus()},s.prototype.changeYearTableHeaderView=function(){if(this.isYearView()){var t=this.state.yearData,e=t[0],a=t[t.length-1];this.$showYear.innerHTML=this.formatYear(e)+" - "+this.formatYear(a)}},s.prototype.changeView=function(a){switch(this.state.showStatus=a,[this.$dateTable,this.$monthTable,this.$yearTable].forEach(function(t,e){t.style.display=e===a?"":"none"}),a){case 0:this.changeDateTableHeaderView();break;case 1:this.changeMonthTableHeaderView();break;case 2:this.changeYearTableHeaderView()}this.toggleMonthBtnView(0===a)},s.prototype.doPrevMonth=function(){this.isDateView()&&(--this.state.month,this.renderForShowStatus())},s.prototype.doNextMonth=function(){this.isDateView()&&(this.state.month+=1,this.renderForShowStatus())},s.prototype.doPrevYear=function(){switch(this.state.showStatus){case 0:case 1:--this.state.year;break;case 2:this.state.year-=10}this.renderForShowStatus()},s.prototype.doNextYear=function(){switch(this.state.showStatus){case 0:case 1:this.state.year+=1;break;case 2:this.state.year+=10}this.renderForShowStatus()},s.prototype.renderForShowStatus=function(){var t=this.state.showStatus;switch(t){case 0:this.initDateData(),this.reRenderDateData();break;case 1:this.initMonthData(),this.reRenderMonthData();break;case 2:this.initYearData(),this.reRenderYearData()}this.toggleMonthBtnView(0===t)},s.prototype.setTodayValue=function(){var t=new Date,e=this.settings;if(!e.disabledDate||"function"!=typeof e.disabledDate||!e.disabledDate(new Date(t.setHours(0,0,0,0)))){var a=t.getFullYear(),i=t.getMonth()+1,n=t.getDate();this.setValue(a,i,n)}},s.prototype.clearValue=function(){this.setValue(null,null,null)},s.prototype.setValue=function(t,e,a){this.state.year=t,this.state.month=e,this.state.date=a;var i=null;t&&e&&a&&(i=new Date(t+"-"+l(e)+"-"+l(a))),this.value=i,this.$input.value=this.formatDate(i,this.getFinalValue("format")),this.hide()},s.prototype.parseFormat=function(t){var e=t.replace(i,"\0").split("\0"),a=t.match(i);if(!e||!e.length||!a||0===a.length)throw new Error("Invalid date format.");return{separators:e,parts:a}},s.prototype.formatDate=function(t,e){if(!t)return t;if("timestamp"===e)return t.getTime();for(var a=this.parseFormat(e),i=this.getI18n(),n={d:t.getDate(),dd:l(t.getDate()),D:i.daysShort[t.getDay()],DD:i.days[t.getDay()],m:t.getMonth()+1,mm:l(t.getMonth()+1),M:i.monthsShort[t.getMonth()],MM:i.months[t.getMonth()],yy:t.getFullYear().toString().substring(2),yyyy:t.getFullYear()},s=[],r=a.separators||[],o=0,h=a.parts.length;o<=h;o++)r.length&&s.push(r.shift()),s.push(n[a.parts[o]]);return s.join("")},s.prototype.formatYear=function(t){var e=this.getI18n().yearTitle;return this.formatDate(new Date(t+"-01-01"),e)},s.prototype.formatMonth=function(t,e){var a=this.getI18n().monthTitle;return this.formatDate(new Date(t+"-"+l(e)+"-01"),a)},s.prototype.getWeekStart=function(){var t=parseInt(Math.abs(this.getFinalValue("weekStart")))%7;return isNaN(t)?0:t},s.prototype.isDateView=function(){return 0===this.state.showStatus},s.prototype.isMonthView=function(){return 1===this.state.showStatus},s.prototype.isYearView=function(){return 2===this.state.showStatus},s.prototype.getDom=function(t){return this.$datePicker.querySelector(t)},s.prototype.isValidClick=function(t){for(var e=t;e;){if(e===this.$datePicker||e===this.$el)return!1;e=e.parentNode}return!0},s.prototype.getI18n=function(){return e.langs[this.settings.lang||"zh-CN"]};var e={langs:{"zh-CN":{days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],daysShort:["周日","周一","周二","周三","周四","周五","周六"],daysMin:["日","一","二","三","四","五","六"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],today:"今天",clear:"清除",format:"yyyy-mm-dd",yearTitle:"yyyy年",monthTitle:"mm月",titleExchange:!(s.prototype.getFinalValue=function(t){var e=this.getI18n();return null!=this.options[t]?this.options[t]:null!=e[t]?e[t]:this.settings[t]}),weekStart:1}},init:function(t,e){for(var a=document.querySelectorAll(t),i=0,n=a.length;i<n;i++)new s(a[i],e)}};return e});