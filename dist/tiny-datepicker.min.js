!function(t){var e="object"==typeof window&&window||"object"==typeof self&&self;"undefined"==typeof module||"undefined"==typeof exports||exports.nodeType?e&&(e.tinyDatePicker=t(),"function"==typeof define&&define.amd&&define([],function(){return e.tinyDatePicker})):module.exports=t()}(function(){function r(t){for(var e=""+t,a=e.length;a++<2;)e="0"+e;return e}function g(t,e){return new Date(t,e-1,1)}function w(t,e){return new Date(t,e-1,0)}function m(t,e){return new Date(t,e,0).getDate()}function u(t){var e="scroll"+t[0].toUpperCase()+t.slice(1);return document.documentElement&&document.documentElement[e]?document.documentElement[e]:document.body[e]}function s(t,e){this.$input=t,this.$datePicker=null,this.value=null,this.state={isVisible:!1,isMounted:!1,showStatus:0,weekData:[],dateData:[],monthData:[],yearData:[],date:null,month:null,year:null},this.initOptions(e),this.register()}s.prototype.initOptions=function(t){this.settings=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(a[s]=n[s])}return a}({value:"",readonly:!1,disabled:!1,editable:!1,clearable:!1,placeholder:"",name:"",format:"yyyy-MM-dd",valueFormat:"yyyy-MM-dd",language:""},t)},s.prototype.register=function(){this.$input.addEventListener("focus",this.onShow.bind(this)),this.$input.addEventListener("blur",this.hide.bind(this)),document.addEventListener("click",this.onHide.bind(this))},s.prototype.onShow=function(){this.state.isVisible||(this.state.isMounted?(this.changeView(0),this.renderForShowStatus(),this.show()):this.init(),this.place())},s.prototype.onHide=function(t){var e=t.target;this.state.isVisible&&this.isValidClick(e)&&this.hide()},s.prototype.show=function(){this.$datePicker&&(this.$datePicker.style.display="block",this.state.isVisible=!0)},s.prototype.hide=function(){this.$datePicker&&(this.$datePicker.style.display="none",this.state.isVisible=!1)},s.prototype.place=function(){var t=this.$input.getBoundingClientRect(),e=this.$datePicker.getBoundingClientRect(),a=t.top,i=t.left,n=t.bottom,s=t.right-i,r=n-a,o=e.right-e.left,h=e.bottom-e.top,d=u("top"),l=u("left"),c=window.innerWidth,p="";p=window.innerHeight<a+h+8?(this.$datePicker.style.top=a-h+d-8+"px","top"):(this.$datePicker.style.top=a+r+d+8+"px","bottom"),c<i+o?(this.$datePicker.style.left=i-o+s+l+"px",p+="-right"):(this.$datePicker.style.left=i+l+"px",p+="-left"),this.$datePicker.className="tiny-datepicker__wrapper tiny-datepicker__"+p},s.prototype.init=function(){this.initData(),this.initDom(),this.render(),this.initEvent()},s.prototype.initData=function(){this.initWeekData(),this.initDateData(),this.initMonthData(),this.initYearData()},s.prototype.initWeekData=function(){this.state.weekData=["日","一","二","三","四","五","六"]},s.prototype.initDateData=function(){var t=this.state.year,e=this.state.month;if(!t||!e){var a=new Date;t=a.getFullYear(),e=a.getMonth()+1}var i=g(t,e),n=g(t,e).getDay();e=i.getMonth()+1;var s=w(t=i.getFullYear(),e),r=w(t,e).getDate(),o=s.getMonth()+1,h=s.getFullYear(),d=m(t,e),l=new Date(t,e,1),c=l.getMonth()+1,p=l.getFullYear(),u=6;if(this.clearDateData(),0===n){for(var y=6;0<=y;y--)this.state.dateData.unshift({day:y,date:r+y-6,month:o,year:h});u--}for(var f=0;f<7*u;f++){var b,D,v;v=f<n?(b=r-n+f+1,D=o,h):d+n-1<f?(b=f-d-n+1,D=c,p):(b=f-n+1,D=e,t),this.state.dateData.push({day:f%7,date:b,month:D,year:v})}this.state.month=e,this.state.year=t},s.prototype.initMonthData=function(){this.state.monthData=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"].map(function(t,e){return{label:t,value:e+1}})},s.prototype.initYearData=function(){var t=this.state.year,e=t-t%10;this.clearYearData();for(var a=0;a<10;a++)this.state.yearData.push(e+a)},s.prototype.initDom=function(){var t=document.createElement("div");t.className="tiny-datepicker__wrapper",t.innerHTML=['<div class="tiny-datepicker__header">','<button class="tiny-datepicker__btn tiny-datepicker__prev-btn tiny-datepicker__prev-year">&lt;&lt;</button>','<button class="tiny-datepicker__btn tiny-datepicker__prev-btn tiny-datepicker__prev-month">&lt;</button>','<span class="tiny-datepicker__header-label tiny-datepicker__show-year"></span>','<span class="tiny-datepicker__header-label tiny-datepicker__show-month"></span>','<button class="tiny-datepicker__btn tiny-datepicker__next-btn tiny-datepicker__next-year">&gt;&gt;</button>','<button class="tiny-datepicker__btn tiny-datepicker__next-btn tiny-datepicker__next-month">&gt;</button>',"</div>",'<div class="tiny-datepicker__body">','<table class="tiny-datepicker__table tiny-datepicker__date-table">',"<thead></thead>","<tbody></tbody>","</table>",'<table class="tiny-datepicker__table tiny-datepicker__month-table">',"<tbody></tbody>","</table>",'<table class="tiny-datepicker__table tiny-datepicker__year-table">',"<tbody></tbody>","</table>","</div>"].join(""),this.$datePicker=t,this.$showYear=this.getDom(".tiny-datepicker__show-year"),this.$showMonth=this.getDom(".tiny-datepicker__show-month"),this.$dateTable=this.getDom(".tiny-datepicker__date-table"),this.$monthTable=this.getDom(".tiny-datepicker__month-table"),this.$yearTable=this.getDom(".tiny-datepicker__year-table"),this.$prevYear=this.getDom(".tiny-datepicker__prev-year"),this.$prevMonth=this.getDom(".tiny-datepicker__prev-month"),this.$nextMonth=this.getDom(".tiny-datepicker__next-month"),this.$nextYear=this.getDom(".tiny-datepicker__next-year")},s.prototype.render=function(){this.renderWeekData(),this.renderDateData(),this.renderMonthData(),this.renderYearData(),this.changeView(this.state.showStatus),this.mount()},s.prototype.mount=function(){this.state.isVisible=!0,this.state.isMounted=!0,document.body.appendChild(this.$datePicker)},s.prototype.renderWeekData=function(){var t=[],e=this.state.weekData;t.push("<tr>");for(var a=0,i=e.length;a<i;a++)t.push("<th>"+e[a]+"</th>");t.push("</tr>"),this.$dateTable.querySelector("thead").innerHTML=t.join("")},s.prototype.renderDateData=function(){for(var t=[],e=this.state.dateData,a=0,i=e.length;a<i;a++){var n=e[a],s=this.getDateTdClass(n);a%7==0&&t.push("<tr>"),t.push('<td class="'+s+'"><span>'+n.date+"</span></td>"),a%7==6&&t.push("</tr>")}this.$dateTable.querySelector("tbody").innerHTML=t.join("")},s.prototype.reRenderDateData=function(){for(var t=this.state.dateData,e=this.$dateTable.querySelectorAll("tbody tr td"),a=0,i=t.length;a<i;a++){var n=t[a],s=e[a];s.className=this.getDateTdClass(n),s.innerHTML="<span>"+n.date+"</span>"}this.changeDateTableHeaderView()},s.prototype.getDateTdClass=function(t){var e=this.state.year,a=this.state.month,i="";if(t.month<a&&t.year<=e)i="prev-month";else if(t.month===a&&t.year===e){i="available";var n=new Date;n.getFullYear()===e&&n.getMonth()+1===a&&n.getDate()===t.date&&(i+=" today"),this.value&&this.value.getFullYear()===e&&this.value.getMonth()+1===a&&this.value.getDate()===t.date&&(i+=" selected")}else i="next-month";return i},s.prototype.renderMonthData=function(){for(var t=[],e=this.state.monthData,a=0,i=e.length;a<i;a++){var n=this.getMonthTdClass(e[a]);a%4==0&&t.push("<tr>"),t.push('<td class="'+n+'"><span>'+e[a].label+"</span></td>"),a%4==3&&t.push("</tr>")}this.$monthTable.querySelector("tbody").innerHTML=t.join("")},s.prototype.reRenderMonthData=function(){for(var t=this.state.monthData,e=this.$monthTable.querySelectorAll("tbody tr td"),a=0,i=t.length;a<i;a++){e[a].className=this.getMonthTdClass(t[a])}this.changeMonthTableHeaderView()},s.prototype.getMonthTdClass=function(t){var e=this.state.year,a="available",i=new Date;return i.getFullYear()===e&&i.getMonth()+1===t.value&&(a+=" today"),this.value&&this.value.getFullYear()===e&&this.value.getMonth()+1===t.value&&(a+=" selected"),a},s.prototype.renderYearData=function(){for(var t=[],e=this.state.yearData,a=0;a<12;a++){var i=this.getYearTdClass(e[a]);a%4==0&&t.push("<tr>"),t.push('<td><span class="'+i+'">'+(e[a]||"")+"</span></td>"),a%4==3&&t.push("</tr>")}this.$yearTable.querySelector("tbody").innerHTML=t.join("")},s.prototype.reRenderYearData=function(){for(var t=this.state.yearData,e=this.$yearTable.querySelectorAll("tbody tr td"),a=0,i=t.length;a<i;a++){var n=t[a],s=e[a];s.className=this.getYearTdClass(n),s.innerHTML="<span>"+n+"</span>"}this.changeYearTableHeaderView()},s.prototype.getYearTdClass=function(t){var e="available";return(new Date).getFullYear()===t&&(e+=" today"),this.value&&this.value.getFullYear()===t&&(e+=" selected"),e},s.prototype.initEvent=function(){this.$showMonth.addEventListener("click",this.changeMonthView.bind(this)),this.$showYear.addEventListener("click",this.changeYearView.bind(this)),this.$prevYear.addEventListener("click",this.doPrevYear.bind(this)),this.$prevMonth.addEventListener("click",this.doPrevMonth.bind(this)),this.$nextMonth.addEventListener("click",this.doNextMonth.bind(this)),this.$nextYear.addEventListener("click",this.doNextYear.bind(this)),this.initChooseEvent()},s.prototype.initChooseEvent=function(){for(var t=[this.$dateTable,this.$monthTable,this.$yearTable],e=["onChooseDate","onChooseMonth","onChooseYear"],a=0,i=t.length;a<i;a++)for(var n=t[a].querySelectorAll("tbody tr td"),s=0,r=n.length;s<r;s++)n[s].addEventListener("click",this[e[a]].bind(this,s))},s.prototype.onChooseDate=function(t){var e=this.state.dateData[t],a=e.date,i=e.month,n=e.year;this.state.date=a,this.state.month=i;var s=(this.state.year=n)+"-"+r(i)+"-"+r(a);this.$input.value=s,this.value=new Date(s),this.hide()},s.prototype.onChooseMonth=function(t){var e=this.state.monthData[t].value;this.state.month=e,this.changeDateView()},s.prototype.onChooseYear=function(t){var e=this.state.yearData[t];this.state.year=e,this.changeMonthView()},s.prototype.toggleMonthBtnView=function(e){[this.$showMonth,this.$prevMonth,this.$nextMonth].forEach(function(t){t.style.display=e?"":"none"})},s.prototype.changeDateView=function(){this.changeView(0),this.renderForShowStatus()},s.prototype.changeDateTableHeaderView=function(){this.isDateView()&&(this.$showYear.innerHTML=this.state.year+"年",this.$showMonth.innerHTML=r(this.state.month)+"月")},s.prototype.changeMonthView=function(){this.changeView(1),this.renderForShowStatus()},s.prototype.changeMonthTableHeaderView=function(){this.isMonthView()&&(this.$showYear.innerHTML=this.state.year+" 年")},s.prototype.changeYearView=function(){this.changeView(2),this.renderForShowStatus()},s.prototype.changeYearTableHeaderView=function(){if(this.isYearView()){var t=this.state.yearData,e=t[0],a=t[t.length-1];this.$showYear.innerHTML=e+" 年 - "+a+" 年"}},s.prototype.changeView=function(a){switch(this.state.showStatus=a,[this.$dateTable,this.$monthTable,this.$yearTable].forEach(function(t,e){t.style.display=e===a?"":"none"}),a){case 0:this.changeDateTableHeaderView();break;case 1:this.changeMonthTableHeaderView();break;case 2:this.changeYearTableHeaderView()}this.toggleMonthBtnView(0===a)},s.prototype.doPrevMonth=function(){this.isDateView()&&(--this.state.month,this.renderForShowStatus())},s.prototype.doNextMonth=function(){this.isDateView()&&(this.state.month+=1,this.renderForShowStatus())},s.prototype.doPrevYear=function(){switch(this.state.showStatus){case 0:case 1:--this.state.year;break;case 2:this.state.year-=10}this.renderForShowStatus()},s.prototype.doNextYear=function(){switch(this.state.showStatus){case 0:case 1:this.state.year+=1;break;case 2:this.state.year+=10}this.renderForShowStatus()},s.prototype.renderForShowStatus=function(){var t=this.state.showStatus;switch(t){case 0:this.initDateData(),this.reRenderDateData();break;case 1:this.initMonthData(),this.reRenderMonthData();break;case 2:this.initYearData(),this.reRenderYearData()}this.toggleMonthBtnView(0===t)},s.prototype.isDateView=function(){return 0===this.state.showStatus},s.prototype.isMonthView=function(){return 1===this.state.showStatus},s.prototype.isYearView=function(){return 2===this.state.showStatus},s.prototype.clearDateData=function(){this.state.dateData=[]},s.prototype.clearYearData=function(){this.state.yearData=[]},s.prototype.getDom=function(t){return this.$datePicker.querySelector(t)},s.prototype.isValidClick=function(t){for(var e=t;e;){if(e===this.$datePicker||e===this.$input)return!1;e=e.parentNode}return!0};var t={init:function(t,e){for(var a=document.querySelectorAll(t),i=0,n=a.length;i<n;i++)new s(a[i],e)}};return t});