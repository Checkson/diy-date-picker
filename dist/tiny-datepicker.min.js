!function(t){var e="object"==typeof window&&window||"object"==typeof self&&self;"undefined"==typeof module||"undefined"==typeof exports||exports.nodeType?e&&(e.tinyDatePicker=t(),"function"==typeof define&&define.amd&&define([],function(){return e.tinyDatePicker})):module.exports=t()}(function(){function g(t,e){return new Date(t,e-1,1)}function k(t,e){return new Date(t,e-1,0)}function m(t,e){return new Date(t,e,0).getDate()}function u(t){var e="scroll"+t[0].toUpperCase()+t.slice(1);return document.documentElement&&document.documentElement[e]?document.documentElement[e]:document.body[e]}function o(t,e){this.$input=t,this.$datePicker=null,this.state={isVisible:!1,isMounted:!1,showStatus:0,weekData:[],dateData:[],monthData:[],yearData:[],day:null,date:null,month:null,year:null},this.initOptions(e),this.register()}o.prototype.initOptions=function(t){this.settings=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(a[o]=n[o])}return a}({value:"",readonly:!1,disabled:!1,editable:!1,clearable:!1,placeholder:"",name:"",format:"yyyy-MM-dd",valueFormat:"yyyy-MM-dd",language:""},t)},o.prototype.register=function(){this.$input.addEventListener("focus",this.onShow.bind(this)),document.addEventListener("click",this.onHide.bind(this))},o.prototype.onShow=function(){this.state.isVisible||(this.state.isMounted?(this.renderForShowStatus(),this.show()):this.init(),this.place())},o.prototype.onHide=function(t){var e=t.target;this.state.isVisible&&this.isValidClick(e)&&this.hide()},o.prototype.show=function(){this.$datePicker&&(this.$datePicker.style.display="block",this.state.isVisible=!0)},o.prototype.hide=function(){this.$datePicker&&(this.$datePicker.style.display="none",this.state.isVisible=!1)},o.prototype.place=function(){var t=this.$input.getBoundingClientRect(),e=this.$datePicker.getBoundingClientRect(),a=t.top,i=t.left,n=t.bottom,o=t.right-i,r=n-a,s=e.right-e.left,h=e.bottom-e.top,d=u("top"),c=u("left"),p=window.innerWidth,l=window.innerHeight;this.$datePicker.style.top=l<a+h?a-h-r+d+"px":a+r+d+"px",this.$datePicker.style.left=p<i+s?i-s+o+c+"px":i+c+"px"},o.prototype.init=function(){this.initData(),this.initDom(),this.render(),this.initEvent()},o.prototype.initData=function(){this.initWeekData(),this.initDateData(),this.initMonthData(),this.initYearData()},o.prototype.initWeekData=function(){this.state.weekData=["日","一","二","三","四","五","六"]},o.prototype.initDateData=function(){var t=this.state.year,e=this.state.month;if(!t||!e){var a=new Date;t=a.getFullYear(),e=a.getMonth()+1}var i=g(t,e),n=g(t,e).getDay();e=i.getMonth()+1;var o=k(t=i.getFullYear(),e),r=k(t,e).getDate(),s=o.getMonth()+1,h=o.getFullYear(),d=m(t,e),c=new Date(t,e,1),p=c.getMonth()+1,l=c.getFullYear(),u=6;if(this.clearDateData(),0===n){for(var y=6;0<=y;y--)this.state.dateData.unshift({day:y,date:r+y-6,month:s,year:h,classIndex:1});u--}for(var b=0;b<7*u;b++){var f,D,w,v=0;b<n?(f=r-n+b+1,D=s,w=h,v=1):d+n-1<b?(f=b-d-n+1,D=p,w=l,v=2):(f=b-n+1,D=e,w=t),this.state.dateData.push({day:b%7,date:f,month:D,year:w,classIndex:v})}this.state.month=e,this.state.year=t},o.prototype.initMonthData=function(){this.state.monthData=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"].map(function(t,e){return{label:t,value:e+1}})},o.prototype.initYearData=function(){var t=this.state.year,e=t-t%10;this.clearYearData();for(var a=0;a<10;a++)this.state.yearData.push(e+a)},o.prototype.initDom=function(){var t=document.createElement("div");t.className="tiny-datepicker__wrapper",t.innerHTML=['<div class="tiny-datepicker__header">','<button class="tiny-datepicker__btn tiny-datepicker__prev-btn tiny-datepicker__prev-year">&lt;&lt;</button>','<button class="tiny-datepicker__btn tiny-datepicker__prev-btn tiny-datepicker__prev-month">&lt;</button>','<span class="tiny-datepicker__header-label tiny-datepicker__show-year"></span>','<span class="tiny-datepicker__header-label tiny-datepicker__show-month"></span>','<button class="tiny-datepicker__btn tiny-datepicker__next-btn tiny-datepicker__next-year">&gt;&gt;</button>','<button class="tiny-datepicker__btn tiny-datepicker__next-btn tiny-datepicker__next-month">&gt;</button>',"</div>",'<div class="tiny-datepicker__body">','<table class="tiny-datepicker__table tiny-datepicker__date-table">',"<thead></thead>","<tbody></tbody>","</table>",'<table class="tiny-datepicker__table tiny-datepicker__month-table">',"<tbody></tbody>","</table>",'<table class="tiny-datepicker__table tiny-datepicker__year-table">',"<tbody></tbody>","</table>","</div>"].join(""),this.$datePicker=t,this.$showYear=this.getDom(".tiny-datepicker__show-year"),this.$showMonth=this.getDom(".tiny-datepicker__show-month"),this.$dateTable=this.getDom(".tiny-datepicker__date-table"),this.$monthTable=this.getDom(".tiny-datepicker__month-table"),this.$yearTable=this.getDom(".tiny-datepicker__year-table"),this.$prevYear=this.getDom(".tiny-datepicker__prev-year"),this.$prevMonth=this.getDom(".tiny-datepicker__prev-month"),this.$nextMonth=this.getDom(".tiny-datepicker__next-month"),this.$nextYear=this.getDom(".tiny-datepicker__next-year")},o.prototype.render=function(){this.renderWeekData(),this.renderDateData(),this.renderMonthData(),this.renderYearData(),this.changeView(this.state.showStatus),this.mount()},o.prototype.mount=function(){this.state.isVisible=!0,this.state.isMounted=!0,document.body.appendChild(this.$datePicker)},o.prototype.renderWeekData=function(){var t=[],e=this.state.weekData;t.push("<tr>");for(var a=0,i=e.length;a<i;a++)t.push("<th>"+e[a]+"</th>");t.push("</tr>"),this.$dateTable.querySelector("thead").innerHTML=t.join("")},o.prototype.renderDateData=function(){for(var t=[],e=this.state.dateData,a=["available","prev-month","next-month"],i=0,n=e.length;i<n;i++){var o=e[i];i%7==0&&t.push("<tr>"),t.push('<td class="'+a[o.classIndex]+'"><span>'+o.date+"</span></td>"),i%7==6&&t.push("</tr>")}this.$dateTable.querySelector("tbody").innerHTML=t.join("")},o.prototype.reRenderDateData=function(){for(var t=this.state.dateData,e=this.$dateTable.querySelectorAll("tbody tr td"),a=["available","prev-month","next-month"],i=0,n=t.length;i<n;i++){var o=t[i],r=e[i];r.className=a[o.classIndex],r.innerHTML="<span>"+o.date+"</span>"}this.changeDateTableHeaderView()},o.prototype.renderMonthData=function(){for(var t=[],e=this.state.monthData,a=0,i=e.length;a<i;a++)a%4==0&&t.push("<tr>"),t.push("<td><span>"+e[a].label+"</span></td>"),a%4==3&&t.push("</tr>");this.$monthTable.querySelector("tbody").innerHTML=t.join("")},o.prototype.reRenderMonthData=function(){this.changeMonthTableHeaderView()},o.prototype.renderYearData=function(){for(var t=[],e=this.state.yearData,a=0;a<12;a++)a%4==0&&t.push("<tr>"),t.push("<td><span>"+(e[a]||"")+"</span></td>"),a%4==3&&t.push("</tr>");this.$yearTable.querySelector("tbody").innerHTML=t.join("")},o.prototype.reRenderYearData=function(){for(var t=this.state.yearData,e=this.$yearTable.querySelectorAll("tbody tr td"),a=0,i=t.length;a<i;a++){var n=t[a];e[a].innerHTML="<span>"+n+"</span>"}this.changeYearTableHeaderView()},o.prototype.initEvent=function(){this.$showMonth.addEventListener("click",this.changeMonthView.bind(this)),this.$showYear.addEventListener("click",this.changeYearView.bind(this)),this.$prevYear.addEventListener("click",this.doPrevYear.bind(this)),this.$prevMonth.addEventListener("click",this.doPrevMonth.bind(this)),this.$nextMonth.addEventListener("click",this.doNextMonth.bind(this)),this.$nextYear.addEventListener("click",this.doNextYear.bind(this)),this.initChooseEvent()},o.prototype.initChooseEvent=function(){for(var t=[this.$dateTable,this.$monthTable,this.$yearTable],e=["onChooseDate","onChooseMonth","onChooseYear"],a=0,i=t.length;a<i;a++)for(var n=t[a].querySelectorAll("tbody tr td"),o=0,r=n.length;o<r;o++)n[o].addEventListener("click",this[e[a]].bind(this,o))},o.prototype.onChooseDate=function(t){var e=this.state.dateData[t],a=e.date,i=e.month,n=e.year;this.state.date=a,this.state.month=i;var o=(this.state.year=n)+"-"+i+"-"+a;this.$input.value=o,this.hide()},o.prototype.onChooseMonth=function(t){var e=this.state.monthData[t].value;this.state.month=e,this.changeDateView()},o.prototype.onChooseYear=function(t){var e=this.state.yearData[t];this.state.year=e,this.changeMonthView()},o.prototype.toggleMonthBtnView=function(e){[this.$showMonth,this.$prevMonth,this.$nextMonth].forEach(function(t){t.style.display=e?"":"none"})},o.prototype.changeDateView=function(){this.changeView(0),this.renderForShowStatus()},o.prototype.changeDateTableHeaderView=function(){this.isDateView()&&(this.$showYear.innerHTML=this.state.year+"年",this.$showMonth.innerHTML=function(t,e,a){for(var i=""+t,n=i.length;n++<a;)i=e+i;return i}(this.state.month,"0",2)+"月")},o.prototype.changeMonthView=function(){this.changeView(1),this.renderForShowStatus()},o.prototype.changeMonthTableHeaderView=function(){this.isMonthView()&&(this.$showYear.innerHTML=this.state.year+" 年")},o.prototype.changeYearView=function(){this.changeView(2),this.renderForShowStatus()},o.prototype.changeYearTableHeaderView=function(){if(this.isYearView()){var t=this.state.yearData,e=t[0],a=t[t.length-1];this.$showYear.innerHTML=e+" 年 - "+a+" 年"}},o.prototype.changeView=function(a){switch(this.state.showStatus=a,[this.$dateTable,this.$monthTable,this.$yearTable].forEach(function(t,e){t.style.display=e===a?"":"none"}),a){case 0:this.changeDateTableHeaderView();break;case 1:this.changeMonthTableHeaderView();break;case 2:this.changeYearTableHeaderView()}this.toggleMonthBtnView(0===a)},o.prototype.doPrevMonth=function(){this.isDateView()&&(--this.state.month,this.renderForShowStatus())},o.prototype.doNextMonth=function(){this.isDateView()&&(this.state.month+=1,this.renderForShowStatus())},o.prototype.doPrevYear=function(){switch(this.state.showStatus){case 0:case 1:--this.state.year;break;case 2:this.state.year-=10}this.renderForShowStatus()},o.prototype.doNextYear=function(){switch(this.state.showStatus){case 0:case 1:this.state.year+=1;break;case 2:this.state.year+=10}this.renderForShowStatus()},o.prototype.renderForShowStatus=function(){var t=this.state.showStatus;switch(t){case 0:this.initDateData(),this.reRenderDateData();break;case 1:this.initMonthData(),this.reRenderMonthData();break;case 2:this.initYearData(),this.reRenderYearData()}this.toggleMonthBtnView(0===t)},o.prototype.isDateView=function(){return 0===this.state.showStatus},o.prototype.isMonthView=function(){return 1===this.state.showStatus},o.prototype.isYearView=function(){return 2===this.state.showStatus},o.prototype.clearDateData=function(){this.state.dateData=[]},o.prototype.clearYearData=function(){this.state.yearData=[]},o.prototype.getDom=function(t){return this.$datePicker.querySelector(t)},o.prototype.isValidClick=function(t){for(var e=t;e;){if(e===this.$datePicker||e===this.$input)return!1;e=e.parentNode}return!0};var t={init:function(t,e){for(var a=document.querySelectorAll(t),i=0,n=a.length;i<n;i++)new o(a[i],e)}};return t});